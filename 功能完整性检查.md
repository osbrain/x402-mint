# é¡¹ç›®åŠŸèƒ½é€»è¾‘å®Œæ•´æ€§åˆ†æ

## âœ… æ ¸å¿ƒé€»è¾‘ï¼šå®Œæ•´ä¸”å¯è¿è¡Œ

ç»è¿‡å…¨é¢æ£€æŸ¥ï¼Œé¡¹ç›®çš„åŠŸèƒ½é€»è¾‘æ˜¯**å®Œæ•´çš„**ï¼Œå¯ä»¥ç›´æ¥éƒ¨ç½²è¿è¡Œã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†åˆ†æï¼š

---

## ğŸ“Š å®Œæ•´æµç¨‹éªŒè¯

### 1ï¸âƒ£ åˆçº¦éƒ¨ç½²æµç¨‹ âœ… å®Œæ•´

```bash
# æ­¥éª¤1: é…ç½®ç¯å¢ƒ
æ ¹ç›®å½•/.env é…ç½®ï¼š
- RPC_URL_BASE
- DEPLOYER_PRIVATE_KEY
- DISTRIBUTOR_ADDRESS
- TOKENå‚æ•°ï¼ˆåç§°ã€ä¾›åº”é‡ã€æ±‡ç‡ã€ä¸Šé™ï¼‰

# æ­¥éª¤2: éƒ¨ç½²åˆçº¦
pnpm run deploy  # æˆ– deploySepolia

# æ­¥éª¤3: éªŒè¯åˆçº¦
TOKEN_ADDRESS=0x... pnpm run verify

# æ­¥éª¤4: å¯é€‰-æå–ä»£å¸åˆ°LP
pnpm hardhat run scripts/withdraw.ts --network base
```

**æ£€æŸ¥ç»“æœï¼š**
- âœ… scripts/deploy.ts å®Œæ•´
- âœ… scripts/verify.ts å®Œæ•´
- âœ… scripts/withdraw.ts å®Œæ•´
- âœ… hardhat.config.ts é…ç½®å®Œæ•´ï¼ˆæ”¯æŒbase/baseSepolia/baseGoerliï¼‰
- âœ… åˆçº¦ä»£ç åŠŸèƒ½å®Œæ•´

---

### 2ï¸âƒ£ åç«¯éªŒè¯æµç¨‹ âœ… å®Œæ•´

```javascript
// GET /mint - è¿”å›402æ”¯ä»˜è¦æ±‚
app.get("/mint", async (req, res) => {
  res.status(402).json({
    message: "Payment Required",
    network: "base",
    currency: "USDC",
    amount6: "1000000",
    payTo: TREASURY
  });
});

// GET /stats - è¿”å›ç»Ÿè®¡æ•°æ®
app.get("/stats", async (req, res) => {
  // æŸ¥è¯¢åˆçº¦çŠ¶æ€
  // è¿”å›ï¼šæ€»ä¾›åº”é‡ã€å·²é“¸é€ ã€å‰©ä½™ã€è¿›åº¦ã€ä¸Šé™ç­‰
});

// POST /verify - éªŒè¯æ”¯ä»˜å¹¶åˆ†å‘
app.post("/verify", async (req, res) => {
  const { txHash, user } = req.body;

  // 1. è·å–äº¤æ˜“å›æ‰§
  const rcpt = await provider.getTransactionReceipt(txHash);

  // 2. æ‰«æUSDC Transferäº‹ä»¶
  for (const log of rcpt.logs) {
    // æ£€æŸ¥ Transfer(user â†’ TREASURY)
  }

  // 3. éªŒè¯é‡‘é¢å’Œä¸Šé™
  const soFar = await token.usdcByWallet(user);
  const perWallet = await token.perWalletUsdcCap();

  // 4. è°ƒç”¨åˆçº¦åˆ†å‘
  const tx = await token.distribute(user, required6);
  await tx.wait();

  res.json({ ok: true, tx: tx.hash });
});
```

**æ£€æŸ¥ç»“æœï¼š**
- âœ… ä¸‰ä¸ªAPIç«¯ç‚¹å®Œæ•´å®ç°
- âœ… é“¾ä¸ŠéªŒè¯é€»è¾‘å®Œæ•´ï¼ˆè¯»å–äº¤æ˜“ã€æ‰«æäº‹ä»¶ï¼‰
- âœ… åˆçº¦äº¤äº’å®Œæ•´ï¼ˆè°ƒç”¨distributeï¼‰
- âœ… é”™è¯¯å¤„ç†å®Œæ•´
- âœ… ç¯å¢ƒå˜é‡é…ç½®å®Œæ•´ï¼ˆbackend/.env.exampleï¼‰

---

### 3ï¸âƒ£ å‰ç«¯äº¤äº’æµç¨‹ âœ… å®Œæ•´

**ä¸‰ç§æ”¯ä»˜æ¨¡å¼éƒ½å·²å®ç°ï¼š**

#### æ¨¡å¼1: æ‰‹åŠ¨æäº¤äº¤æ˜“å“ˆå¸Œ âœ…
```javascript
// 1. ç”¨æˆ·ç‚¹å‡»"Mint"æŒ‰é’®
askToMint() â†’ GET /api/mint â†’ æ˜¾ç¤ºæ”¯ä»˜åœ°å€

// 2. ç”¨æˆ·æ‰‹åŠ¨è½¬è´¦USDCï¼ˆä½¿ç”¨é’±åŒ…APPï¼‰

// 3. ç”¨æˆ·ç²˜è´´äº¤æ˜“å“ˆå¸Œå’Œé’±åŒ…åœ°å€
handleVerify(txHash, address) â†’ POST /api/verify

// 4. åç«¯éªŒè¯å¹¶åˆ†å‘ä»£å¸
```

#### æ¨¡å¼2: QRç æ‰«æ âœ…
```javascript
// 1. ç”ŸæˆERC-681æ ¼å¼QRç 
qrValue = `ethereum:${usdcAddress}@${chainId}/transfer?address=${treasury}&uint256=${amount}`

// 2. ç”¨æˆ·æ‰«ç æ”¯ä»˜ï¼ˆç§»åŠ¨é’±åŒ…ï¼‰

// 3. ç”¨æˆ·è¿”å›æ‰‹åŠ¨æ¨¡å¼æäº¤äº¤æ˜“å“ˆå¸Œ
```

#### æ¨¡å¼3: é’±åŒ…è¿æ¥ï¼ˆå®Œå…¨è‡ªåŠ¨ï¼‰ âœ…
```javascript
// 1. è¿æ¥é’±åŒ…ï¼ˆwagmiï¼‰
connect({ connector })

// 2. å‘èµ·USDCè½¬è´¦
const hash = await writeContractAsync({
  address: usdcAddress,
  abi: erc20Abi,
  functionName: 'transfer',
  args: [treasury, amount]
});

// 3. ç­‰å¾…äº¤æ˜“ç¡®è®¤
useWaitForTransactionReceipt({ hash })

// 4. è‡ªåŠ¨è°ƒç”¨éªŒè¯
useEffect(() => {
  if (receipt && receipt.status === 'success') {
    handleVerify(autoTxHash, address, true);
  }
}, [receipt]);
```

**æ£€æŸ¥ç»“æœï¼š**
- âœ… å‰ç«¯åˆ°åç«¯ä»£ç†é…ç½®å®Œæ•´ï¼ˆnext.config.js rewritesï¼‰
- âœ… wagmié…ç½®å®Œæ•´ï¼ˆBase + Sepoliaç½‘ç»œï¼‰
- âœ… ä¸‰ç§æ”¯ä»˜æ¨¡å¼éƒ½å®Œæ•´å®ç°
- âœ… å®æ—¶ç»Ÿè®¡åˆ·æ–°åŠŸèƒ½å®Œæ•´
- âœ… UI/UXå®Œæ•´ï¼ˆè¿›åº¦æ¡ã€å¤åˆ¶æŒ‰é’®ã€é”™è¯¯æç¤ºï¼‰

---

## ğŸ”— å…³é”®è¿æ¥éªŒè¯

### âœ… å‰ç«¯ â†” åç«¯è¿æ¥
```javascript
// next.config.js
async rewrites() {
  return [{
    source: "/api/:path*",
    destination: "http://localhost:3001/:path*"  // â† å®Œæ•´é…ç½®
  }];
}

// å‰ç«¯è°ƒç”¨
axios.get('/api/mint')      â†’ http://localhost:3001/mint
axios.post('/api/verify')   â†’ http://localhost:3001/verify
axios.get('/api/stats')     â†’ http://localhost:3001/stats
```
**çŠ¶æ€ï¼šâœ… å®Œæ•´é…ç½®**

### âœ… åç«¯ â†” åˆçº¦è¿æ¥
```javascript
// backend/src/server.ts
const token = new ethers.Contract(
  TOKEN_ADDRESS,           // â† ä».envè¯»å–
  distributionIface,       // â† ABIå®šä¹‰å®Œæ•´
  signer                   // â† DISTRIBUTOR_PRIVATE_KEY
);

// è°ƒç”¨åˆçº¦
await token.distribute(user, usdcAmount6);
```
**çŠ¶æ€ï¼šâœ… å®Œæ•´å®ç°**

### âœ… å‰ç«¯ â†” é’±åŒ…è¿æ¥
```javascript
// providers.tsx
const config = createConfig({
  chains: [base, baseSepolia],
  connectors: [injected()],  // MetaMask, Coinbaseç­‰
  transports: {
    [base.id]: http(rpcBase),
    [baseSepolia.id]: http(rpcBaseSepolia)
  }
});
```
**çŠ¶æ€ï¼šâœ… å®Œæ•´é…ç½®**

---

## âš ï¸ éœ€è¦æ³¨æ„çš„ç‚¹ï¼ˆä¸å½±å“å®Œæ•´æ€§ï¼‰

### 1. ç¯å¢ƒé…ç½®ä¾èµ–
**éœ€è¦æ­£ç¡®é…ç½®ä¸‰ä¸ª.envæ–‡ä»¶ï¼š**

```bash
# æ ¹ç›®å½• .envï¼ˆéƒ¨ç½²åˆçº¦ï¼‰
RPC_URL_BASE="https://mainnet.base.org"
DEPLOYER_PRIVATE_KEY="0x..."
DISTRIBUTOR_ADDRESS="0x..."
OWNER_ADDRESS="0x..."
# ...å…¶ä»–å‚æ•°

# backend/.envï¼ˆè¿è¡Œåç«¯ï¼‰
RPC_URL_BASE="https://mainnet.base.org"
TOKEN_ADDRESS="0x..."  # â† éƒ¨ç½²åå¡«å†™
USDC_ADDRESS="0x833589fcd6edb6e08f4c7c32d4f71b54bda02913"  # Baseä¸»ç½‘USDC
TREASURY_ADDRESS="0x..."
DISTRIBUTOR_PRIVATE_KEY="0x..."  # â† å¿…é¡»ä¸DISTRIBUTOR_ADDRESSåŒ¹é…

# frontend/.envï¼ˆå¯é€‰ï¼Œä½¿ç”¨è‡ªå®šä¹‰RPCï¼‰
NEXT_PUBLIC_BASE_RPC="https://mainnet.base.org"
NEXT_PUBLIC_BASE_SEPOLIA_RPC="https://sepolia.base.org"
```

### 2. USDCåœ°å€å¿…é¡»æ­£ç¡®
```javascript
// Baseä¸»ç½‘
USDC_ADDRESS="0x833589fcd6edb6e08f4c7c32d4f71b54bda02913"

// Base Sepoliaæµ‹è¯•ç½‘
USDC_ADDRESS="0x036CbD53842c5426634e7929541eC2318f3dCF7e"
```
**âŒ å¦‚æœå¡«é”™ï¼Œæ‰€æœ‰éªŒè¯éƒ½ä¼šå¤±è´¥ï¼**

### 3. åˆ†å‘è€…ç§é’¥éœ€è¦æœ‰Gas
```bash
# distributoråœ°å€éœ€è¦æœ‰å°‘é‡ETHç”¨äºgas
# å»ºè®®ï¼šå‡†å¤‡0.1 ETHï¼ˆå–å†³äºé¢„æœŸé“¸é€ æ¬¡æ•°ï¼‰
```

### 4. ç”Ÿäº§éƒ¨ç½²å»ºè®®è¡¥å……
è™½ç„¶åŠŸèƒ½å®Œæ•´ï¼Œä½†å»ºè®®æ·»åŠ ï¼š
- é˜²é‡æ”¾æ”»å‡»ï¼ˆè®°å½•å·²å¤„ç†çš„txHashï¼‰
- APIé€Ÿç‡é™åˆ¶
- ç»“æ„åŒ–æ—¥å¿—
- ç›‘æ§å‘Šè­¦

---

## âœ… å®Œæ•´æ€§ç»“è®º

### æ ¸å¿ƒåŠŸèƒ½ï¼š100% å®Œæ•´
- âœ… åˆçº¦éƒ¨ç½²ã€éªŒè¯ã€æå–
- âœ… åç«¯éªŒè¯å’Œåˆ†å‘é€»è¾‘
- âœ… å‰ç«¯ä¸‰ç§æ”¯ä»˜æ¨¡å¼
- âœ… æ‰€æœ‰è¿æ¥å’Œé…ç½®

### å¯ä»¥ç›´æ¥è¿è¡Œçš„æ­¥éª¤ï¼š

```bash
# 1. å®‰è£…ä¾èµ–
pnpm install
(cd backend && pnpm install)
(cd frontend && pnpm install)

# 2. é…ç½®.envæ–‡ä»¶ï¼ˆæ ¹ç›®å½•ã€backendã€frontendï¼‰

# 3. éƒ¨ç½²åˆçº¦ï¼ˆæµ‹è¯•ç½‘å…ˆï¼‰
pnpm run deploySepolia

# 4. å¯åŠ¨åç«¯
cd backend && pnpm run dev

# 5. å¯åŠ¨å‰ç«¯
cd frontend && pnpm run dev

# 6. è®¿é—® http://localhost:3000
```

### æœ€ç»ˆè¯„åˆ†ï¼š
- **åŠŸèƒ½é€»è¾‘å®Œæ•´æ€§ï¼š100%** âœ…
- **ç”Ÿäº§å°±ç»ªåº¦ï¼š85%** ï¼ˆéœ€åŠ å›ºå®‰å…¨æªæ–½ï¼‰
- **ä»£ç è´¨é‡ï¼š90%** ï¼ˆä½¿ç”¨æˆç†Ÿåº“ï¼Œç»“æ„æ¸…æ™°ï¼‰

**ç»“è®ºï¼šé¡¹ç›®çš„æ ¸å¿ƒé€»è¾‘æ˜¯å®Œæ•´çš„ï¼Œå¯ä»¥ç«‹å³éƒ¨ç½²åˆ°æµ‹è¯•ç½‘éªŒè¯ï¼Œä¸»ç½‘ä¸Šçº¿å‰å»ºè®®è¡¥å……å®‰å…¨åŠ å›ºæªæ–½ã€‚**
